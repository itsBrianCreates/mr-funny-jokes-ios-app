---
phase: 14-binary-rating-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - MrFunnyJokes/MrFunnyJokes/Views/GrainOMeterView.swift
  - MrFunnyJokes/MrFunnyJokes/Views/JokeDetailSheet.swift
  - MrFunnyJokes/MrFunnyJokes/Models/Joke.swift
  - MrFunnyJokes/MrFunnyJokes/Views/MonthlyTopTen/MonthlyTopTenDetailView.swift
autonomous: true

must_haves:
  truths:
    - "User sees two clearly labeled options (Hilarious and Horrible) on the joke detail sheet rating section"
    - "Tapping a rating option triggers haptic feedback and a smooth visual transition"
    - "User can change their rating by tapping the other option"
    - "Feed cards show the correct binary emoji indicator (ðŸ˜‚ for Hilarious, ðŸ«  for Horrible)"
    - "No trace of old 5-emoji slider remains in the UI"
  artifacts:
    - path: "MrFunnyJokes/MrFunnyJokes/Views/GrainOMeterView.swift"
      provides: "BinaryRatingView (replaces GroanOMeterView) and CompactRatingView (replaces CompactGroanOMeterView)"
      contains: "BinaryRatingView"
    - path: "MrFunnyJokes/MrFunnyJokes/Models/Joke.swift"
      provides: "Binary-only ratingEmoji mapping"
      contains: "ratingEmoji"
  key_links:
    - from: "MrFunnyJokes/MrFunnyJokes/Views/GrainOMeterView.swift"
      to: "HapticManager.shared"
      via: "selection() call on tap"
      pattern: "HapticManager\\.shared\\.selection"
    - from: "MrFunnyJokes/MrFunnyJokes/Views/JokeDetailSheet.swift"
      to: "MrFunnyJokes/MrFunnyJokes/Views/GrainOMeterView.swift"
      via: "BinaryRatingView instantiation"
      pattern: "BinaryRatingView"
    - from: "MrFunnyJokes/MrFunnyJokes/Views/GrainOMeterView.swift"
      to: "onRate callback"
      via: "Int parameter (1 or 5)"
      pattern: "onRate\\(.*\\.rating\\)"
---

<objective>
Replace the 5-emoji drag slider (GroanOMeterView) with a binary Hilarious/Horrible rating control across all touchpoints.

Purpose: Phase 13 migrated all data to binary (1 and 5). The UI must now match â€” users should see a clear two-option choice that feels responsive and satisfying, with no trace of the old 5-point scale.

Output: Binary rating input view, binary compact indicator, updated model emoji mapping, updated call sites and previews.
</objective>

<execution_context>
@/Users/brianvanaski/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brianvanaski/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-binary-rating-ui/14-RESEARCH.md

Key source files:
@MrFunnyJokes/MrFunnyJokes/Views/GrainOMeterView.swift
@MrFunnyJokes/MrFunnyJokes/Views/JokeDetailSheet.swift
@MrFunnyJokes/MrFunnyJokes/Models/Joke.swift
@MrFunnyJokes/MrFunnyJokes/Views/MonthlyTopTen/MonthlyTopTenDetailView.swift
@MrFunnyJokes/MrFunnyJokes/Views/JokeCardView.swift
@MrFunnyJokes/MrFunnyJokes/Views/CharacterDetailView.swift
@MrFunnyJokes/MrFunnyJokes/Views/JokeOfTheDayView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace GroanOMeterView and CompactGroanOMeterView with binary versions</name>
  <files>
    MrFunnyJokes/MrFunnyJokes/Views/GrainOMeterView.swift
    MrFunnyJokes/MrFunnyJokes/Models/Joke.swift
  </files>
  <action>
Edit `GrainOMeterView.swift` IN PLACE (do not create a new file â€” keeps Xcode project file unchanged).

**Replace `GroanOMeterView` with `BinaryRatingView`:**

Create a new `BinaryRatingView` struct that replaces the entire `GroanOMeterView` struct. Key design:
- Props: `let currentRating: Int?` and `let onRate: (Int) -> Void` (same callback signature)
- Define an inner `RatingOption` enum with cases `.hilarious` (emoji: "ðŸ˜‚", rating: 5) and `.horrible` (emoji: "ðŸ« ", rating: 1)
- Derive `selectedOption: RatingOption?` from `currentRating` (5 â†’ .hilarious, 1 â†’ .horrible, else nil)
- Layout: VStack with "Rate joke" header, then HStack with two styled Button views
- Each button: HStack of emoji Text + option name Text, full-width via `.frame(maxWidth: .infinity)`, vertical padding 12
- Selected state: green background (0.2 opacity) with green border for Hilarious, red background (0.2 opacity) with red border for Horrible. Unselected: `Color(.tertiarySystemFill)` background, no border
- Background uses RoundedRectangle(cornerRadius: 10) with `.clipShape` and `.overlay` for border
- On tap: call `HapticManager.shared.selection()` then wrap `onRate(option.rating)` in `withAnimation(.easeInOut(duration: 0.2))` for smooth visual transition
- Use `.buttonStyle(.plain)` on each button
- No drag gestures, no GeometryReader, no @GestureState â€” these are simple tap buttons

**Replace `CompactGroanOMeterView` with `CompactRatingView`:**

Create a new `CompactRatingView` struct replacing the entire `CompactGroanOMeterView` struct:
- Prop: `let rating: Int?`
- Body: `if let rating = rating` then switch on rating: case 5 â†’ Text("ðŸ˜‚").font(.callout), case 1 â†’ Text("ðŸ« ").font(.callout), default â†’ EmptyView()
- No array lookup â€” direct switch only

**Update previews at the bottom of the file:**
- Replace `GroanOMeterView` preview instances with `BinaryRatingView` (ratings: nil, 1, 5)
- Replace `CompactGroanOMeterView` preview instances with `CompactRatingView` (ratings: 1, 5, nil)
- Remove any preview that uses ratings 2, 3, or 4

**Update `Joke.swift` model:**

Edit the `ratingEmoji` computed property to only map 1 and 5:
```swift
var ratingEmoji: String? {
    guard let rating = userRating else { return nil }
    switch rating {
    case 1: return "ðŸ« "
    case 5: return "ðŸ˜‚"
    default: return nil
    }
}
```

Update `ratingEmojis` static array from 5 elements to 2:
```swift
static let ratingEmojis = ["ðŸ« ", "ðŸ˜‚"]
```

IMPORTANT: Keep the `onRate: (Int) -> Void` callback signature unchanged. The new UI sends 1 or 5 â€” same interface, different values.
  </action>
  <verify>
Build the project: `xcodebuild -project MrFunnyJokes/MrFunnyJokes.xcodeproj -scheme MrFunnyJokes -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | tail -5`

Verify no references to old types remain in GrainOMeterView.swift: grep for "GroanOMeterView", "CompactGroanOMeterView", "ratingOptions" â€” should return zero matches in that file.

Verify binary-only emojis in Joke.swift: grep for `case 2:`, `case 3:`, `case 4:` in ratingEmoji â€” should return zero matches.
  </verify>
  <done>GrainOMeterView.swift contains BinaryRatingView and CompactRatingView with no trace of 5-point scale. Joke.ratingEmoji maps only 1 and 5. Joke.ratingEmojis has 2 elements. Project builds cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Update all call sites to use the new binary rating views</name>
  <files>
    MrFunnyJokes/MrFunnyJokes/Views/JokeDetailSheet.swift
    MrFunnyJokes/MrFunnyJokes/Views/JokeCardView.swift
    MrFunnyJokes/MrFunnyJokes/Views/CharacterDetailView.swift
    MrFunnyJokes/MrFunnyJokes/Views/JokeOfTheDayView.swift
    MrFunnyJokes/MrFunnyJokes/Views/MonthlyTopTen/MonthlyTopTenDetailView.swift
  </files>
  <action>
**JokeDetailSheet.swift (line ~48):**
Change `GroanOMeterView(currentRating: joke.userRating, onRate: onRate)` to `BinaryRatingView(currentRating: joke.userRating, onRate: onRate)`. Same parameters â€” just the type name changes.

Update preview if any hardcoded `userRating` values use 2, 3, or 4 â€” change to nil, 1, or 5.

**JokeCardView.swift:**
Find `CompactGroanOMeterView(rating:` and replace with `CompactRatingView(rating:`. Same parameter.

Update any preview `Joke(... userRating: ...)` that uses 2, 3, or 4 to use nil, 1, or 5.

**CharacterDetailView.swift:**
Find `CompactGroanOMeterView(rating:` and replace with `CompactRatingView(rating:`. Same parameter.

**JokeOfTheDayView.swift:**
Find `CompactGroanOMeterView(rating:` and replace with `CompactRatingView(rating:`. Same parameter.

**MonthlyTopTenDetailView.swift (line ~127):**
Change the empty state text from:
`"Be one of the first to rate jokes this month!\nJokes rated \(type == .hilarious ? "5 stars" : "1 star") will appear here."`
to:
`"Be one of the first to rate jokes!\nJokes rated \(type == .hilarious ? "Hilarious ðŸ˜‚" : "Horrible ðŸ« ") will appear here."`

This updates the copy to use binary language and removes the "this month" phrasing (prep for Phase 16 all-time transition).

IMPORTANT: Do NOT change the `onRate: (Int) -> Void` callback signature anywhere. It stays as-is.
  </action>
  <verify>
Build the project: `xcodebuild -project MrFunnyJokes/MrFunnyJokes.xcodeproj -scheme MrFunnyJokes -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | tail -5`

Grep entire project for "GroanOMeterView" and "CompactGroanOMeterView" â€” should return zero matches (confirming complete replacement).

Grep for "5 stars" and "1 star" in MonthlyTopTenDetailView.swift â€” should return zero matches.
  </verify>
  <done>All call sites use BinaryRatingView and CompactRatingView. No references to GroanOMeterView or CompactGroanOMeterView remain in the project. MonthlyTopTenDetailView empty state uses binary language. Project builds cleanly with zero compile errors.</done>
</task>

</tasks>

<verification>
1. Full project build succeeds with zero errors
2. Grep for "GroanOMeterView" across entire project returns zero matches
3. Grep for "CompactGroanOMeterView" across entire project returns zero matches
4. Grep for `case 2:` or `case 3:` or `case 4:` in Joke.swift ratingEmoji returns zero matches
5. Grep for "5 stars" or "1 star" in MonthlyTopTenDetailView returns zero matches
6. BinaryRatingView exists in GrainOMeterView.swift with haptic feedback (HapticManager.shared.selection)
7. BinaryRatingView uses withAnimation for smooth transition
8. CompactRatingView exists and handles only ratings 1 and 5
</verification>

<success_criteria>
- BinaryRatingView replaces GroanOMeterView in JokeDetailSheet with two clear options (Hilarious/Horrible)
- CompactRatingView replaces CompactGroanOMeterView on all feed cards (JokeCardView, CharacterDetailView, JokeOfTheDayView)
- Haptic feedback fires on rating selection
- Visual transition animates smoothly on selection
- Joke.ratingEmoji maps only 1â†’ðŸ«  and 5â†’ðŸ˜‚
- No trace of 5-point scale UI remains anywhere in the codebase
- Project compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/14-binary-rating-ui/14-01-SUMMARY.md`
</output>
