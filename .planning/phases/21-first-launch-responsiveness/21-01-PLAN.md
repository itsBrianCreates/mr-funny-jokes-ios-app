---
phase: 21-first-launch-responsiveness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - MrFunnyJokes/MrFunnyJokes/Utilities/HapticManager.swift
  - MrFunnyJokes/MrFunnyJokes/App/MrFunnyJokesApp.swift
autonomous: true

must_haves:
  truths:
    - "Tapping a joke card on first launch shows the detail sheet without perceptible delay"
    - "Tapping Share/Copy in the detail sheet responds immediately on first launch"
    - "First launch and subsequent launches feel equally responsive"
  artifacts:
    - path: "MrFunnyJokes/MrFunnyJokes/Utilities/HapticManager.swift"
      provides: "Pre-prepared haptic engines with warmUp() method"
      contains: "prepare()"
    - path: "MrFunnyJokes/MrFunnyJokes/App/MrFunnyJokesApp.swift"
      provides: "Service pre-warming during splash screen"
      contains: "warmUp"
  key_links:
    - from: "MrFunnyJokes/MrFunnyJokes/App/MrFunnyJokesApp.swift"
      to: "HapticManager.warmUp()"
      via: "Called during RootView.onAppear before splash dismisses"
      pattern: "HapticManager\\.shared\\.warmUp"
---

<objective>
Fix first-launch unresponsiveness by pre-warming cold-start services during the splash screen.

Purpose: On first launch, tapping joke cards, sharing, and copying feels sluggish because the Taptic Engine, Firebase Firestore connection, and UI system services are cold. The splash screen already displays for 1-5 seconds — this plan uses that time to warm up these services so the app is fully responsive the moment the user can interact.

Output: Modified HapticManager with engine pre-preparation, and RootView with service pre-warming during splash.
</objective>

<execution_context>
@/Users/brianvanaski/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brianvanaski/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@MrFunnyJokes/MrFunnyJokes/Utilities/HapticManager.swift
@MrFunnyJokes/MrFunnyJokes/App/MrFunnyJokesApp.swift
@MrFunnyJokes/MrFunnyJokes/Services/FirestoreService.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add haptic engine pre-preparation to HapticManager</name>
  <files>MrFunnyJokes/MrFunnyJokes/Utilities/HapticManager.swift</files>
  <action>
Add a `warmUp()` method to HapticManager that pre-prepares the haptic engines used during user interactions.

Currently, each haptic method creates a new UIImpactFeedbackGenerator and calls `impactOccurred()` without prior preparation. On first activation after app launch, the Taptic Engine has a noticeable cold-start delay (~100-200ms). Apple's documentation recommends calling `prepare()` ahead of time to reduce this latency.

Implementation:
1. Add stored properties for the three most-used generators:
   - `private let lightGenerator = UIImpactFeedbackGenerator(style: .light)`
   - `private let mediumGenerator = UIImpactFeedbackGenerator(style: .medium)`
   - `private let selectionGenerator = UISelectionFeedbackGenerator()`
   - `private let notificationGenerator = UINotificationFeedbackGenerator()`

2. Add a `warmUp()` method that calls `prepare()` on each stored generator. This tells the Taptic Engine to get ready, significantly reducing the delay on first feedback.

3. Update the existing `lightTap()`, `mediumImpact()`, `selection()`, and `success()` methods to use the stored generators instead of creating new ones each time. Call `prepare()` again after each use (Apple docs recommend re-preparing after each occurrence for consistent low-latency).

4. Keep `heavyImpact()`, `soft()`, and `rigid()` creating generators on-demand since they are rarely used and don't need pre-warming.

Do NOT change the class to @MainActor — haptic feedback generators are thread-safe.
  </action>
  <verify>Build the project with Cmd+B in Xcode (or `xcodebuild build`) to confirm no compilation errors. Verify the warmUp() method exists and stored generators are used in the high-frequency methods.</verify>
  <done>HapticManager has a warmUp() method that pre-prepares haptic engines, and frequently-used haptic methods use stored generators with re-preparation after each use.</done>
</task>

<task type="auto">
  <name>Task 2: Pre-warm services during splash screen in RootView</name>
  <files>MrFunnyJokes/MrFunnyJokes/App/MrFunnyJokesApp.swift</files>
  <action>
Add service pre-warming in RootView's `.onAppear` block, during the splash screen display. The splash screen already shows for 1-5 seconds while content loads — use this time to warm up cold services.

In the existing `Task { @MainActor in ... }` block inside RootView's `.onAppear`, BEFORE the `jokeViewModel = JokeViewModel()` line, add these pre-warming steps:

1. **Haptic engine warm-up**: Call `HapticManager.shared.warmUp()` to pre-prepare the Taptic Engine. This must happen before the splash dismisses so the first card tap is responsive.

2. **Firestore connection warm-up**: Access `FirestoreService.shared` to trigger the singleton's `init()` which configures Firestore settings and establishes the connection. The `JokeViewModel.init()` already accesses this via `firestoreService = FirestoreService.shared`, but we want to ensure the Firestore instance is fully initialized before the ViewModel starts making queries. Add `_ = FirestoreService.shared` as an explicit warm-up line before the ViewModel creation. This ensures the `Firestore.firestore()` call and `PersistentCacheSettings` configuration happen before any queries are attempted.

The final order in the Task block should be:
```swift
await Task.yield()
// Pre-warm services during splash
HapticManager.shared.warmUp()
_ = FirestoreService.shared
// Now create ViewModel (will use already-warm services)
jokeViewModel = JokeViewModel()
startSplashTimer()
startMaximumSplashTimer()
```

This is a minimal, targeted change. Do NOT restructure RootView, SplashTransitionView, or the splash timing logic. Do NOT add any new views or modify the splash screen appearance.
  </action>
  <verify>Build the project to confirm no compilation errors. Verify the pre-warming calls appear in the correct order in RootView's onAppear block.</verify>
  <done>RootView pre-warms HapticManager and FirestoreService during splash screen display, before ViewModel creation, so all services are ready when the user first interacts with the app.</done>
</task>

</tasks>

<verification>
1. Build succeeds without errors or warnings
2. HapticManager.warmUp() exists and calls prepare() on stored generators
3. RootView.onAppear pre-warms HapticManager and FirestoreService before creating JokeViewModel
4. No changes to splash screen timing, appearance, or transition logic
5. No new dependencies or external services introduced
</verification>

<success_criteria>
- App builds successfully
- HapticManager uses pre-prepared stored generators for high-frequency haptic methods
- Services are pre-warmed during splash screen before user can interact
- First-launch tap responsiveness matches subsequent launches (verified by UAT on device)
</success_criteria>

<output>
After completion, create `.planning/phases/21-first-launch-responsiveness/21-01-SUMMARY.md`
</output>
