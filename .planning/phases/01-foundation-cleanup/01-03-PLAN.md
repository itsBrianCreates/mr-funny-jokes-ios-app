---
phase: 01-foundation-cleanup
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - MrFunnyJokes/MrFunnyJokes/Views/SettingsView.swift
autonomous: true

must_haves:
  truths:
    - "User can toggle notifications on/off in Settings"
    - "User sees 'Manage Notifications' button when notifications are enabled"
    - "Tapping 'Manage Notifications' opens iOS Settings app notification page"
    - "User sees friendly helper text explaining where to adjust notification timing"
    - "Time picker is no longer visible in app Settings"
  artifacts:
    - path: "MrFunnyJokes/MrFunnyJokes/Views/SettingsView.swift"
      provides: "Settings screen UI"
      contains: "openNotificationSettingsURLString"
  key_links:
    - from: "SettingsView.swift"
      to: "iOS Settings"
      via: "UIApplication.shared.open"
      pattern: "openNotificationSettingsURLString"
---

<objective>
Simplify notification settings by removing the in-app time picker and adding iOS Settings deep link.

Purpose: Follow native iOS patterns - let users manage notification timing through iOS Settings instead of duplicate in-app UI. This reduces custom UI complexity (better for 4.2.2 optics) while maintaining functionality.
Output: Settings screen with toggle + Settings deep link + helper text, no time picker.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-cleanup/01-CONTEXT.md
@.planning/phases/01-foundation-cleanup/01-RESEARCH.md
@MrFunnyJokes/MrFunnyJokes/Views/SettingsView.swift
@MrFunnyJokes/MrFunnyJokes/Services/NotificationManager.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove time picker and add iOS Settings button</name>
  <files>MrFunnyJokes/MrFunnyJokes/Views/SettingsView.swift</files>
  <action>
  Update SettingsView.swift notification section:

  1. REMOVE the `@State private var showingTimePicker = false` state variable

  2. REMOVE the entire time picker button and DatePicker block (lines ~46-82 in current file):
     - The Button that shows "Notification Time" with chevron
     - The `if showingTimePicker { DatePicker(...) }` block

  3. ADD a new "Manage Notifications" button when notifications are enabled:
     ```swift
     if notificationManager.notificationsEnabled {
         Button {
             if let url = URL(string: UIApplication.openNotificationSettingsURLString) {
                 UIApplication.shared.open(url)
             }
         } label: {
             HStack {
                 Label {
                     Text("Manage Notifications")
                 } icon: {
                     Image(systemName: "gear")
                         .foregroundStyle(.blue)
                 }
                 Spacer()
                 Image(systemName: "arrow.up.right")
                     .font(.caption)
                     .foregroundStyle(.tertiary)
             }
         }
         .foregroundStyle(.primary)
     }
     ```

  4. UPDATE the section footer text:
     Change from: "Get a daily notification with a fresh joke to brighten your day."
     To: "Want to adjust when you get jokes? Tap above to manage your notification preferences in Settings."

  5. UPDATE the `openSystemSettings()` helper method to use the notification-specific URL:
     Change from: `UIApplication.openSettingsURLString`
     To: `UIApplication.openNotificationSettingsURLString`

     This ensures the permission warning "Open Settings" button also goes directly to notification settings.

  6. KEEP the main toggle intact - no changes to the Toggle(isOn:) or its onChange handler

  7. KEEP the permission warning section intact - no changes except the URL update in step 5

  Note: Do NOT remove anything from NotificationManager.swift - the `notificationHour`, `notificationMinute`, and time-related properties are still used for scheduling notifications. Only the UI for selecting the time is being removed.
  </action>
  <verify>
    - grep "showingTimePicker" SettingsView.swift returns no results
    - grep "DatePicker" SettingsView.swift returns no results
    - grep "openNotificationSettingsURLString" SettingsView.swift returns results
  </verify>
  <done>Settings view shows toggle + Manage button + helper text, no time picker</done>
</task>

<task type="auto">
  <name>Task 2: Verify NotificationManager still schedules correctly</name>
  <files>MrFunnyJokes/MrFunnyJokes/Services/NotificationManager.swift</files>
  <action>
  Verify that NotificationManager.swift is NOT modified:

  1. Confirm `notificationHour` and `notificationMinute` properties still exist
  2. Confirm `notificationTime` computed property still exists (for potential future use)
  3. Confirm `formattedTime` computed property still exists
  4. Confirm `scheduleJokeOfTheDayNotification()` still uses these values

  Do NOT remove any code from NotificationManager. The time properties are still used:
  - For scheduling the actual notification
  - For syncing with iOS notification settings via `syncWithScheduledNotification()`
  - Default time (9:00 AM) is stored in UserDefaults

  The only change is that users will adjust timing through iOS Settings instead of in-app picker. The app respects whatever iOS Settings specifies.
  </action>
  <verify>NotificationManager.swift contains "notificationHour" and "scheduleJokeOfTheDayNotification"</verify>
  <done>NotificationManager unchanged - time scheduling still works via stored defaults and iOS Settings</done>
</task>

</tasks>

<verification>
1. Build succeeds: `xcodebuild -project MrFunnyJokes.xcodeproj -scheme MrFunnyJokes build`
2. Run app on simulator, navigate to Settings:
   - Toggle should be visible and functional
   - When enabled, "Manage Notifications" button should appear
   - Tapping button should open iOS Settings (may show alert on simulator)
   - No time picker or time display should be visible
   - Footer text should mention Settings
3. Verify NotificationManager has no changes (git diff should show only SettingsView.swift)
</verification>

<success_criteria>
- Time picker completely removed from Settings UI
- "Manage Notifications" button visible when notifications enabled
- Button uses `openNotificationSettingsURLString` (iOS 16+, app targets iOS 17+)
- Helper text guides users to iOS Settings
- Notification scheduling still works (NotificationManager unchanged)
- App compiles and runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-cleanup/01-03-SUMMARY.md`
</output>
