---
phase: 15-me-tab-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - MrFunnyJokes/MrFunnyJokes/Views/MeView.swift
  - MrFunnyJokes/MrFunnyJokes/ViewModels/JokeViewModel.swift
autonomous: true

must_haves:
  truths:
    - "Me tab displays a segmented control with Hilarious and Horrible segments (no collapsible sections, no List)"
    - "Each segment label shows a count badge with the number of jokes in that category"
    - "Switching segments shows only jokes for the selected category"
    - "Me tab uses ScrollView > LazyVStack > Picker(.segmented) matching MonthlyTopTenDetailView pattern"
    - "Tapping a joke row opens JokeDetailSheet with full rating controls"
    - "Empty state displays per-segment when a segment has no jokes"
    - "No dead code remains: selectedMeCategory, filteredRatedJokes, filteredHilariousJokes, filteredHorribleJokes, selectMeCategory are removed"
  artifacts:
    - path: "MrFunnyJokes/MrFunnyJokes/Views/MeView.swift"
      provides: "Segmented Me tab with Picker, ScrollView/LazyVStack layout, card-style joke rows"
      contains: "Picker.*segmented"
    - path: "MrFunnyJokes/MrFunnyJokes/ViewModels/JokeViewModel.swift"
      provides: "Clean ViewModel without dead Me tab filter code"
  key_links:
    - from: "MeView.swift"
      to: "JokeViewModel"
      via: "viewModel.hilariousJokes / viewModel.horribleJokes"
      pattern: "viewModel\\.hilariousJokes|viewModel\\.horribleJokes"
    - from: "MeView.swift"
      to: "RankingType enum"
      via: "Picker selection state"
      pattern: "selectedType.*RankingType"
    - from: "MeView.swift"
      to: "JokeDetailSheet"
      via: "sheet presentation on joke row tap"
      pattern: "\\.sheet.*JokeDetailSheet"
---

<objective>
Redesign the Me tab from a List-based sectioned layout to a segmented-control layout matching MonthlyTopTenDetailView, with count badges on segments and card-style joke rows. Clean up dead ViewModel code.

Purpose: Deliver a consistent UI across Me tab and Top 10 detail view (ME-01, ME-02, ME-03), removing dead category filter infrastructure.
Output: Rewritten MeView.swift with segmented Picker pattern; cleaned JokeViewModel.swift without dead filter code.
</objective>

<execution_context>
@/Users/brianvanaski/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brianvanaski/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@MrFunnyJokes/MrFunnyJokes/Views/MonthlyTopTen/MonthlyTopTenDetailView.swift
@MrFunnyJokes/MrFunnyJokes/Views/MonthlyTopTen/RankedJokeCard.swift
@MrFunnyJokes/MrFunnyJokes/Views/MeView.swift
@MrFunnyJokes/MrFunnyJokes/ViewModels/JokeViewModel.swift
@MrFunnyJokes/MrFunnyJokes/Models/FirestoreModels.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite MeView to segmented-control layout with card-style rows</name>
  <files>MrFunnyJokes/MrFunnyJokes/Views/MeView.swift</files>
  <action>
Rewrite MeView.swift to replace the List-based sectioned layout with a ScrollView/LazyVStack/Picker(.segmented) pattern matching MonthlyTopTenDetailView. Specific changes:

1. **Add `@State private var selectedType: RankingType = .hilarious`** — segment selection state, same as MonthlyTopTenDetailView.

2. **Replace `ratedJokesList`** with a new body structure:
   - Top-level conditional: if `viewModel.ratedJokes.isEmpty` show existing `emptyState`, else show segmented content.
   - Remove the `filteredRatedJokes.isEmpty` / `filteredEmptyState` branch entirely (dead code path, `selectedMeCategory` is always nil).

3. **Segmented content structure** (match MonthlyTopTenDetailView lines 44-87):
   ```
   ScrollView {
       LazyVStack(spacing: 12) {
           // Picker with count badges (ME-02)
           Picker("Category", selection: $selectedType) {
               ForEach(RankingType.allCases) { type in
                   Text("\(type.emoji) \(type.rawValue) (\(jokesCount(for: type)))").tag(type)
               }
           }
           .pickerStyle(.segmented)
           .padding(.top, 4)
           .padding(.bottom, 8)

           // Content for selected segment
           if currentJokes.isEmpty {
               // Per-segment empty state reusing EmptyStateView from MonthlyTopTenDetailView
               EmptyStateView(type: selectedType)
                   .frame(minHeight: 300)
           } else {
               ForEach(currentJokes) { joke in
                   // Card-style joke row (see step 4)
               }
           }

           // Bottom scroll padding
           Color.clear.frame(height: 20)
       }
       .padding(.horizontal)
   }
   ```

4. **Card-style joke rows** — Wrap JokeRowView content in a card container matching RankedJokeCard visual style (`.regularMaterial` background, `RoundedRectangle(cornerRadius: 16)`, shadow). The row is a `Button` that sets `selectedJokeId = joke.id` and triggers `HapticManager.shared.mediumImpact()`. No rank badge (unlike RankedJokeCard). Layout:
   ```
   Button { HapticManager.shared.mediumImpact(); selectedJokeId = joke.id } label: {
       VStack(alignment: .leading, spacing: 10) {
           Text(joke.setup)
               .font(.body.weight(.medium))
               .foregroundStyle(.primary)
               .multilineTextAlignment(.leading)
               .frame(maxWidth: .infinity, alignment: .leading)

           HStack(spacing: 8) {
               if let character = jokeCharacter(for: joke) {
                   CharacterIndicatorView(character: character)
               }
               HStack(spacing: 4) {
                   Image(systemName: joke.category.icon)
                   Text(joke.category.rawValue)
               }
               .font(.caption)
               .foregroundStyle(.secondary)
           }
       }
       .padding()
       .background(.regularMaterial, in: RoundedRectangle(cornerRadius: 16))
       .shadow(color: .black.opacity(0.05), radius: 2, x: 0, y: 1)
   }
   .buttonStyle(.plain)
   ```

5. **Helper computed properties:**
   - `private var currentJokes: [Joke]` — returns `viewModel.hilariousJokes` or `viewModel.horribleJokes` based on `selectedType`.
   - `private func jokesCount(for type: RankingType) -> Int` — returns count from `viewModel.hilariousJokes.count` or `viewModel.horribleJokes.count`.
   - `private func jokeCharacter(for joke: Joke) -> JokeCharacter?` — extracted from existing JokeRowView logic.

6. **Sheet presentation** — Keep existing `.sheet` binding pattern using `selectedJokeId` and `selectedJoke` computed property. Attach `.sheet` to the ScrollView (same level as current List).

7. **Remove entirely:**
   - `filteredEmptyState` computed property (references dead `selectedMeCategory`)
   - The `ratingSection` function (List-specific, no longer needed)
   - The standalone `JokeRowView` struct (its content is now inlined as a card; if other views use JokeRowView, keep it — but grep confirms it's only used in MeView)

8. **Keep:** `emptyState` view (for when `ratedJokes` is completely empty), `selectedJokeId` state, `selectedJoke` computed property, `#Preview`.

9. **Update `#Preview`** to use the new view (just `MeView(viewModel: JokeViewModel())` in a NavigationStack, same as current).

**Important anti-patterns to avoid (from CLAUDE.md):**
- Do NOT use `.animation()` on ScrollView or LazyVStack. Use `withAnimation` at mutation site if animation is needed.
- Do NOT use `ForEach(Array(collection.enumerated()))`. Use `ForEach(currentJokes)` with Identifiable.
- Do NOT put a List inside a ScrollView. Use LazyVStack directly.
  </action>
  <verify>
Build the project in Xcode (or `xcodebuild build` if available). Confirm:
- No compiler errors referencing `filteredRatedJokes`, `filteredHilariousJokes`, `filteredHorribleJokes`, `selectedMeCategory`, `JokeRowView` (if removed).
- MeView body contains `Picker` with `.pickerStyle(.segmented)`.
- MeView body contains `ScrollView` > `LazyVStack`.
- No `.animation()` modifiers on scroll containers.
- `EmptyStateView(type:)` used for per-segment empty state.
  </verify>
  <done>
MeView shows a Picker(.segmented) with "Hilarious (N)" and "Horrible (N)" segments. Selecting a segment shows card-style joke rows from that category. Tapping a row opens JokeDetailSheet. Per-segment empty state shows when a segment has no jokes. No List, no collapsible sections, no swipe actions remain.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove dead Me tab filter infrastructure from JokeViewModel</name>
  <files>MrFunnyJokes/MrFunnyJokes/ViewModels/JokeViewModel.swift</files>
  <action>
Remove the following dead code from JokeViewModel.swift. These are all only referenced by MeView (which Task 1 rewrites to use `hilariousJokes`/`horribleJokes` directly):

1. **Remove property (line 9):**
   ```swift
   @Published var selectedMeCategory: JokeCategory? = nil
   ```

2. **Remove MARK section and 3 computed properties (lines 116-140):**
   ```swift
   // MARK: - Filtered Rated Jokes (for Me tab)

   /// Rated jokes filtered by the selected Me tab category
   var filteredRatedJokes: [Joke] { ... }

   /// Hilarious jokes filtered by the selected Me tab category
   var filteredHilariousJokes: [Joke] { ... }

   /// Horrible jokes filtered by the selected Me tab category
   var filteredHorribleJokes: [Joke] { ... }
   ```

3. **Remove MARK section and function (lines 985-990):**
   ```swift
   // MARK: - Me Tab Category Selection

   func selectMeCategory(_ category: JokeCategory?) {
       HapticManager.shared.lightTap()
       selectedMeCategory = category
   }
   ```

**Keep untouched:** `ratedJokes`, `hilariousJokes`, `horribleJokes`, `sortByRatingTimestamp` — these are the live computed properties MeView now uses directly.
  </action>
  <verify>
Grep the entire MrFunnyJokes directory for `selectedMeCategory`, `filteredRatedJokes`, `filteredHilariousJokes`, `filteredHorribleJokes`, `selectMeCategory`. All results should return zero matches.

Build the project to confirm no compilation errors from missing properties.
  </verify>
  <done>
JokeViewModel has no `selectedMeCategory` property, no `filteredRatedJokes`/`filteredHilariousJokes`/`filteredHorribleJokes` computed properties, and no `selectMeCategory()` method. The "Filtered Rated Jokes (for Me tab)" and "Me Tab Category Selection" MARK sections are gone. `hilariousJokes`, `horribleJokes`, and `ratedJokes` remain as the clean data source.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds with no errors or warnings related to removed properties
2. Grep for `filteredRatedJokes|filteredHilariousJokes|filteredHorribleJokes|selectedMeCategory|selectMeCategory` returns zero matches across the entire project
3. MeView.swift contains `Picker` with `.pickerStyle(.segmented)` and `ScrollView` > `LazyVStack`
4. MeView.swift segment labels include count in format `"emoji name (count)"`
5. No `.animation()` modifiers on scroll containers (per CLAUDE.md)
6. `EmptyStateView(type:)` reused for per-segment empty state
7. Card-style rows use `.regularMaterial` background with rounded corners
</verification>

<success_criteria>
- Me tab displays Picker(.segmented) with Hilarious and Horrible segments, each showing joke count
- Switching segments shows only jokes for that category in card-style rows
- Tapping a joke opens JokeDetailSheet
- Me tab layout matches MonthlyTopTenDetailView pattern (ScrollView > LazyVStack > Picker)
- All dead code removed from JokeViewModel (5 items: 1 property, 3 computed properties, 1 function)
- Project builds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-me-tab-redesign/15-01-SUMMARY.md`
</output>
