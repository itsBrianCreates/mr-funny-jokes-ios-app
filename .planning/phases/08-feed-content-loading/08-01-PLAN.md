---
phase: 08-feed-content-loading
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - MrFunnyJokes/MrFunnyJokes/Views/JokeFeedView.swift
autonomous: true

must_haves:
  truths:
    - "Scrolling to the bottom of the feed automatically triggers loading more jokes"
    - "No 'Load More Jokes' button appears in the feed UI"
    - "When loading fails, a retry button appears with consistent styling"
    - "Skeleton cards appear at bottom of feed while loading more jokes"
  artifacts:
    - path: "MrFunnyJokes/MrFunnyJokes/Views/JokeFeedView.swift"
      provides: "Automatic infinite scroll, retry button, no LoadMoreButton"
      contains: "loadMoreIfNeeded"
  key_links:
    - from: "JokeFeedView.swift"
      to: "JokeViewModel.loadMoreIfNeeded"
      via: "onAppear in ForEach"
      pattern: "viewModel\\.loadMoreIfNeeded"
---

<objective>
Implement automatic infinite scroll in the main joke feed, removing the manual "Load More" button.

Purpose: Users can browse jokes continuously without tapping a button, matching the pattern already established in CharacterDetailView.

Output: JokeFeedView with automatic scroll-triggered pagination and inline retry on failure.
</objective>

<execution_context>
@/Users/brianvanaski/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brianvanaski/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-feed-content-loading/08-CONTEXT.md
@.planning/phases/08-feed-content-loading/08-RESEARCH.md
@MrFunnyJokes/MrFunnyJokes/Views/JokeFeedView.swift
@MrFunnyJokes/MrFunnyJokes/Views/CharacterDetailView.swift
@MrFunnyJokes/MrFunnyJokes/ViewModels/JokeViewModel.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add automatic scroll-triggered loading to JokeFeedView</name>
  <files>MrFunnyJokes/MrFunnyJokes/Views/JokeFeedView.swift</files>
  <action>
Adapt the infinite scroll pattern from CharacterDetailView to JokeFeedView:

1. In the ForEach loop for feedJokes, add `.onAppear` modifier to each joke card that calls `viewModel.loadMoreIfNeeded(currentItem: joke)`. This triggers loading when user scrolls near the bottom. The pattern already exists in CharacterDetailView lines 176-179.

2. Remove the LoadMoreButton section entirely:
   - Delete the conditional block: `if !viewModel.isLoadingMore && viewModel.hasMoreJokes && !feedJokes.isEmpty { LoadMoreButton { ... } }`
   - Keep the LoadingMoreView (skeleton cards) - it's already shown when `viewModel.isLoadingMore` is true

3. Add error state handling with retry button:
   - Add `@State private var loadingFailed = false` to JokeFeedView
   - Add a new RetryLoadButton view (below EndOfFeedView) that reuses LoadMoreButton's styling but with different text:
     ```swift
     struct RetryLoadButton: View {
         let action: () -> Void
         private let primaryYellow = Color(red: 1.0, green: 0.84, blue: 0.0)

         var body: some View {
             Button(action: action) {
                 HStack(spacing: 8) {
                     Text("Retry Loading")
                         .font(.headline.weight(.semibold))
                     Image(systemName: "arrow.clockwise.circle.fill")
                         .font(.title3)
                 }
                 .foregroundStyle(.black)
                 .frame(maxWidth: .infinity)
                 .padding(.vertical, 14)
                 .background(primaryYellow)
                 .clipShape(Capsule())
             }
             .buttonStyle(.plain)
             .padding(.top, 8)
         }
     }
     ```
   - Note: The actual error state tracking will be added in Plan 02 when we modify JokeViewModel. For now, just add the RetryLoadButton view definition.

4. Keep LoadMoreButton view definition in the file (but don't use it) - we may need it for reference or other screens.

The existing `viewModel.loadMoreIfNeeded(currentItem:)` method in JokeViewModel already implements threshold detection (3 items from end), so no changes needed there for this task.
  </action>
  <verify>
Build the app in Xcode:
- `xcodebuild -project MrFunnyJokes/MrFunnyJokes.xcodeproj -scheme MrFunnyJokes -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | tail -20`
- Verify no build errors
- Verify LoadMoreButton no longer appears in feed by searching the view body
  </verify>
  <done>
- JokeFeedView calls loadMoreIfNeeded on each joke card's onAppear
- LoadMoreButton is not rendered in the feed (view definition can remain)
- RetryLoadButton view is defined for future use
- App builds successfully
  </done>
</task>

</tasks>

<verification>
1. Build succeeds without errors
2. In JokeFeedView body, LoadMoreButton is not rendered
3. Each joke card in ForEach has .onAppear calling loadMoreIfNeeded
4. RetryLoadButton view is defined in file
</verification>

<success_criteria>
- App builds and runs
- Scrolling through the feed triggers automatic loading when approaching the end
- No "Load More Jokes" button visible in the feed
- Skeleton cards appear at bottom while loading more jokes
</success_criteria>

<output>
After completion, create `.planning/phases/08-feed-content-loading/08-01-SUMMARY.md`
</output>
