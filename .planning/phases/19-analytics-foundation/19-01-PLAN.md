---
phase: 19-analytics-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - MrFunnyJokes/MrFunnyJokes.xcodeproj/project.pbxproj
  - MrFunnyJokes/MrFunnyJokes/GoogleService-Info.plist
  - MrFunnyJokes/MrFunnyJokes/Services/AnalyticsService.swift
autonomous: true

must_haves:
  truths:
    - "App builds and runs with FirebaseAnalytics SPM product linked to the MrFunnyJokes app target"
    - "Firebase Analytics auto-initializes on app launch via existing FirebaseApp.configure() call — no additional setup code required"
    - "AnalyticsService.shared singleton exists following the same pattern as FirestoreService.shared, HapticManager.shared, etc."
    - "AnalyticsService exposes methods that call Analytics.logEvent() with descriptive event names and minimal parameters"
  artifacts:
    - path: "MrFunnyJokes/MrFunnyJokes/Services/AnalyticsService.swift"
      provides: "Analytics service singleton with event logging methods"
      contains: "static let shared"
    - path: "MrFunnyJokes/MrFunnyJokes/GoogleService-Info.plist"
      provides: "Firebase config with analytics enabled"
      contains: "IS_ANALYTICS_ENABLED"
  key_links:
    - from: "MrFunnyJokes/MrFunnyJokes/Services/AnalyticsService.swift"
      to: "FirebaseAnalytics"
      via: "import FirebaseAnalytics and Analytics.logEvent() calls"
      pattern: "import FirebaseAnalytics"
    - from: "MrFunnyJokes/MrFunnyJokes.xcodeproj/project.pbxproj"
      to: "firebase-ios-sdk"
      via: "SPM product dependency"
      pattern: "FirebaseAnalytics"
---

<objective>
Add FirebaseAnalytics to the app and create the AnalyticsService singleton that Phase 20 will use to instrument user actions.

Purpose: Establishes the analytics foundation — dependency, configuration, and service layer — so event instrumentation in Phase 20 can focus purely on wiring calls into existing ViewModels.

Output: App builds with FirebaseAnalytics linked, GoogleService-Info.plist enables analytics, and AnalyticsService.swift provides ready-to-use event logging methods.
</objective>

<execution_context>
@/Users/brianvanaski/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brianvanaski/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@MrFunnyJokes/MrFunnyJokes/Services/FirestoreService.swift (singleton pattern reference — first 30 lines)
@MrFunnyJokes/MrFunnyJokes/Utilities/HapticManager.swift (simpler singleton pattern reference)
@MrFunnyJokes/MrFunnyJokes/App/MrFunnyJokesApp.swift (FirebaseApp.configure() call — line 10)
@MrFunnyJokes/MrFunnyJokes/GoogleService-Info.plist (current plist — IS_ANALYTICS_ENABLED is false)
@MrFunnyJokes/MrFunnyJokes.xcodeproj/project.pbxproj (current SPM deps — FirebaseCore + FirebaseFirestore)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add FirebaseAnalytics SPM product and enable analytics in plist</name>
  <files>
    MrFunnyJokes/MrFunnyJokes.xcodeproj/project.pbxproj
    MrFunnyJokes/MrFunnyJokes/GoogleService-Info.plist
  </files>
  <action>
Two changes:

**1. Add FirebaseAnalytics SPM product to the app target in project.pbxproj:**

The firebase-ios-sdk package is already added (XCRemoteSwiftPackageReference `C340D9612EE0A55A007A6AFF`). Add a new `XCSwiftPackageProductDependency` for FirebaseAnalytics following the exact same pattern as FirebaseCore (`C340D9622EE0A55A007A6AFF`) and FirebaseFirestore (`C340D9642EE0A55A007A6AFF`):

- Add a new PBXBuildFile entry for "FirebaseAnalytics in Frameworks"
- Add it to the app target's Frameworks build phase (same section as FirebaseCore and FirebaseFirestore)
- Add a new XCSwiftPackageProductDependency entry referencing the same package (`C340D9612EE0A55A007A6AFF`) with `productName = FirebaseAnalytics`
- Add the dependency to the app target's `packageProductDependencies` array

Use unique UUIDs that don't conflict with existing entries. Follow the exact formatting of the existing Firebase product entries.

**2. Update GoogleService-Info.plist:**

Change `IS_ANALYTICS_ENABLED` from `<false></false>` to `<true></true>`.

No changes to MrFunnyJokesApp.swift — `FirebaseApp.configure()` already initializes all enabled Firebase services including Analytics. Setting IS_ANALYTICS_ENABLED to true is sufficient for auto-initialization.
  </action>
  <verify>
Build the project with `xcodebuild build -project MrFunnyJokes/MrFunnyJokes.xcodeproj -scheme MrFunnyJokes -destination 'platform=iOS Simulator,name=iPhone 16' -quiet`. Build must succeed with 0 errors. Grep the pbxproj for "FirebaseAnalytics" to confirm 3 entries exist (PBXBuildFile, Frameworks reference, XCSwiftPackageProductDependency). Grep GoogleService-Info.plist to confirm IS_ANALYTICS_ENABLED is followed by true.
  </verify>
  <done>FirebaseAnalytics SPM product is linked to the MrFunnyJokes app target and IS_ANALYTICS_ENABLED is true in GoogleService-Info.plist. App builds successfully.</done>
</task>

<task type="auto">
  <name>Task 2: Create AnalyticsService singleton with event logging methods</name>
  <files>
    MrFunnyJokes/MrFunnyJokes/Services/AnalyticsService.swift
    MrFunnyJokes/MrFunnyJokes.xcodeproj/project.pbxproj
  </files>
  <action>
Create `MrFunnyJokes/MrFunnyJokes/Services/AnalyticsService.swift` following the HapticManager singleton pattern (simple, no state, no ObservableObject needed).

```swift
import Foundation
import FirebaseAnalytics

/// Service for logging analytics events to Firebase Analytics.
/// Wraps Analytics.logEvent() with app-specific event methods.
/// Phase 20 will wire these methods into ViewModels.
final class AnalyticsService {
    static let shared = AnalyticsService()

    private init() {}

    // MARK: - Rating Events

    /// Log when a user rates a joke as Hilarious or Horrible
    func logJokeRated(jokeId: String, character: String, rating: String) {
        Analytics.logEvent("joke_rated", parameters: [
            "joke_id": jokeId,
            "character": character,
            "rating": rating
        ])
    }

    // MARK: - Share Events

    /// Log when a user copies or shares a joke
    func logJokeShared(jokeId: String, method: String) {
        Analytics.logEvent("joke_shared", parameters: [
            "joke_id": jokeId,
            "method": method
        ])
    }

    // MARK: - Navigation Events

    /// Log when a user selects a character from the home screen
    func logCharacterSelected(characterId: String) {
        Analytics.logEvent("character_selected", parameters: [
            "character_id": characterId
        ])
    }
}
```

Key design decisions:
- `final class` with `private init()` and `static let shared` — matches FirestoreService, HapticManager, LocalStorageService patterns exactly.
- No `@MainActor` — Analytics.logEvent() is thread-safe and doesn't manage UI state.
- No `ObservableObject` — this service has no published state for views to observe.
- `rating` parameter is `String` (not Int) — accepts "hilarious" or "horrible" for human-readable Firebase Console display.
- `method` parameter on logJokeShared — accepts "copy" or "share" to distinguish the two actions.
- Event names use snake_case (`joke_rated`, `joke_shared`, `character_selected`) — Firebase Analytics convention.
- Minimal parameters per event — only what's needed for Phase 20 requirements (EVNT-01, EVNT-02, EVNT-03).

**Register AnalyticsService.swift in project.pbxproj:**

This project requires explicit pbxproj registration — Xcode does NOT auto-include Swift files from disk. All existing service files (FirestoreService.swift, LocalStorageService.swift, HapticManager.swift, NetworkMonitor.swift) have explicit entries. Follow the FirestoreService.swift pattern:

1. **PBXBuildFile section** — Add an entry like:
   `{UNIQUE_UUID_1} /* AnalyticsService.swift in Sources */ = {isa = PBXBuildFile; fileRef = {UNIQUE_UUID_2} /* AnalyticsService.swift */; };`

2. **PBXFileReference section** — Add an entry like:
   `{UNIQUE_UUID_2} /* AnalyticsService.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = AnalyticsService.swift; sourceTree = "<group>"; };`

3. **Services group children** (group `A50000000000000000000008`) — Add `{UNIQUE_UUID_2} /* AnalyticsService.swift */,` to the children array alongside FirestoreService.swift, LocalStorageService.swift, and NetworkMonitor.swift.

4. **PBXSourcesBuildPhase sources list** — Add `{UNIQUE_UUID_1} /* AnalyticsService.swift in Sources */,` to the files array alongside other source file entries.

Use unique UUIDs that don't conflict with any existing entries. Follow the exact formatting of the FirestoreService.swift entries.
  </action>
  <verify>
Verify the file exists at the correct path. Grep project.pbxproj for "AnalyticsService" and confirm 4+ entries exist (PBXBuildFile, PBXFileReference, Services group child, PBXSourcesBuildPhase). Rebuild with `xcodebuild build -project MrFunnyJokes/MrFunnyJokes.xcodeproj -scheme MrFunnyJokes -destination 'platform=iOS Simulator,name=iPhone 16' -quiet` to confirm the new service compiles without errors and FirebaseAnalytics import resolves. Grep the file for "static let shared" and "Analytics.logEvent" to confirm the singleton and event methods exist.
  </verify>
  <done>AnalyticsService.shared singleton exists in Services/ directory with three methods: logJokeRated, logJokeShared, logCharacterSelected. Each method calls Analytics.logEvent() with descriptive event names and minimal parameters. App builds successfully.</done>
</task>

</tasks>

<verification>
1. `xcodebuild build` succeeds with FirebaseAnalytics linked and AnalyticsService.swift compiled
2. `grep -c "FirebaseAnalytics" project.pbxproj` returns 3+ (PBXBuildFile, Frameworks, PackageProductDependency)
3. `grep "IS_ANALYTICS_ENABLED" GoogleService-Info.plist` shows followed by `<true>`
4. AnalyticsService.swift contains `static let shared`, `import FirebaseAnalytics`, and 3 `Analytics.logEvent()` calls
5. No changes to MrFunnyJokesApp.swift — FirebaseApp.configure() auto-initializes Analytics
</verification>

<success_criteria>
- App builds and runs with FirebaseAnalytics SPM product linked
- GoogleService-Info.plist has IS_ANALYTICS_ENABLED = true
- AnalyticsService.shared singleton follows existing service pattern
- Three event methods ready for Phase 20 instrumentation: logJokeRated, logJokeShared, logCharacterSelected
- Zero additional setup code in app entry point
</success_criteria>

<output>
After completion, create `.planning/phases/19-analytics-foundation/19-01-SUMMARY.md`
</output>
